# 什么是信道化子接口

信道化子接口是指使能了信道化功能的以太物理端口的子接口。通过不同信道化子接口承载不同类型的业务，并基于信道化子接口配置带宽，实现同一物理接口上不同信道化子接口之间的带宽严格隔离，解决了不同子接口间业务相互抢占带宽的问题。信道化子接口是[网络切片](https://info.support.huawei.com/info-finder/encyclopedia/zh/%E7%BD%91%E7%BB%9C%E5%88%87%E7%89%87.html "网络切片")方案实现资源预留的手段，为每个网络切片划分独立“车道”，不同网络切片业务流量在传输过程中不能并线变换“车道”，从而确保不同[切片](https://info.support.huawei.com/info-finder/encyclopedia/zh/%E7%BD%91%E7%BB%9C%E5%88%87%E7%89%87.html "网络切片")业务严格隔离，有效避免流量突发时切片业务之间的资源抢占。

以上来自于华为的定义，这段描述不像是人能看懂的。简而言之，如下图所示。

<img src="http://123.57.190.49:12121/api/image/X40HJ2Z6.png" title="" alt="" data-align="center">

大致的意思是，1Gbps的物理端口，将200Mbps留给东西专用，这个东西不一定是切片，也可能是用户，还可能是业务。例如我将这200Mbps留给游戏数据。

# HQoS

传统的[QoS](https://info.support.huawei.com/info-finder/encyclopedia/zh/QoS.html "QoS")采用一级调度，单个端口只能区分业务优先级，无法区分用户。只要属于同一优先级的流量，使用同一个端口队列，不同用户的流量彼此之间竞争同一个队列资源，无法对端口上单个用户的单个流量进行区分服务。HQoS采用多级调度的方式，可以精细区分不同用户和不同业务的流量，提供区分的带宽管理，所以HQoS即[层次化QoS](https://info.support.huawei.com/info-finder/encyclopedia/zh/HQoS.html "HQoS")，是一种通过多级队列调度机制，解决[Diffserv](https://info.support.huawei.com/info-finder/encyclopedia/zh/QoS.html "QoS")模型下多用户多业务带宽保证的技术。

<img src="http://123.57.190.49:12121/api/image/TR6T88L4.png" title="" alt="" data-align="center">

人话就是，QoS是一级队列，觉得分的不够细，引入的多级队列，称为HQoS，经典的计算机思路，加一层，减一层，一点不考虑程序员的头发，与其分这么细，不如去换一个多口的交换机。HQoS最小的单位是FQ，也就是业务流量，一个用户可以有8个FQ，对应不同的业务流量。FQ是最底层的叶子节点。上面这张图片是从流量的类型角度划分的，没有体现出来调度器。下面这张图片加入了调度器，其中SP是一个调度算法。

<img src="http://123.57.190.49:12121/api/image/2PH6Z648.png" title="" alt="" data-align="center">

# 使用HQoS实现信道化子接口的方案

![](http://123.57.190.49:12121/api/image/860J6N82.png)

上图是流量层级的图。因此没有出现调度器。（其实WRR是一种调度策略）

信道化子接口借助多级队列可以和主接口有不同的调度策略。如果使用QoS，那么是无法区分这一点的。（其实也可以，例如，我可以将几个QoS的值专门用来给子信道，但是使用多级队列后，子信道和主信道可以使用所有的QoS值）。

使用HQoS实现信道化子接口一种简单的方式是按用户划分，将几个用户的流量划分到信道化的子接口，其余用户使用主接口。如上图所示。

还有一种方案比较复杂，其架构如图。

<img src="http://123.57.190.49:12121/api/image/XJHL8PJ2.png" title="" alt="" data-align="center">

前半部分和上面的方案是一致的，在中间加一个Mapping来做一波映射，这样可以将不同用户的流量放在不同一个队列里面，增加灵活性。例如在上一种方案里面，只能为VIP用户的流量分出200Mbps的带宽，但是使用下面的方案，可以实现，将所有用户的游戏流量区分出来，分配200Mbps带宽。当然这张图片层级比较多，可以削减一些层级来降低复杂度。该方案，芯片不一定支持。



192.168.157.95
